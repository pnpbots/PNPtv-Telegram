[supervisord]
nodaemon=true
user=root
logfile=/tmp/supervisord.log
pidfile=/tmp/supervisord.pid
loglevel=info
environment=PYTHONUNBUFFERED=1

[unix_http_server]
file=/tmp/supervisor.sock

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# Telegram Bot Process - Increased priority
[program:telegram_bot]
command=python bot_wrapper.py
directory=/app
autostart=true
autorestart=true
startretries=5
startsecs=10
stdout_logfile=/tmp/telegram_bot.log
stderr_logfile=/tmp/telegram_bot_error.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
environment=PYTHONUNBUFFERED=1,PYTHONPATH=.
priority=100
user=root

# Payment Webhook Process - Critical for payments
[program:payment_webhook]
command=python -m bot.payment_webhook
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=5
stdout_logfile=/tmp/webhook.log
stderr_logfile=/tmp/webhook_error.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
environment=PYTHONUNBUFFERED=1,PYTHONPATH=.,PORT=%(ENV_PORT)s
priority=200
user=root

# Admin Panel Process - Lower priority
[program:admin_panel]
command=python run_admin.py
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=5
stdout_logfile=/tmp/admin_panel.log
stderr_logfile=/tmp/admin_panel_error.log
stdout_logfile_maxbytes=5MB
stderr_logfile_maxbytes=5MB
environment=PYTHONUNBUFFERED=1,PYTHONPATH=.,ADMIN_PORT=8080
priority=300
user=root

# Group all processes for easier management
[group:pnp_bot]
programs=telegram_bot,payment_webhook,admin_panel
priority=999
